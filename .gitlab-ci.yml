---
stages:
  - lint
  - test

variables:
  PYTHON_VERSION: "3.11"
  PYTHON_IMAGE: "${CI_DEPENDENCY_PROXY_GROUP_IMAGE_PREFIX}/python:${PYTHON_VERSION}-alpine3.18"

python:
  stage: lint
  image: "${PYTHON_IMAGE}"
  script:
    - pip install -r test_requirements.txt
    - flake8 .

unittest:
  stage: test
  image: "${PYTHON_IMAGE}"
  before_script:
    - pip install -r test_requirements.txt
    - pip freeze > test_requirements.freeze
    - python --version
  script:
    - pytest tests
    - coverage run --source errata_server `which pytest` tests
    - coverage report
...
